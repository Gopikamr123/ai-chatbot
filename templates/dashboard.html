{% extends "base.html" %}
{% block title %}Dashboard — Ai{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block topbar_actions %}
  <a href="{{ url_for('chat') }}" class="btn btn-primary">
    <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
    Open Chat
  </a>
{% endblock %}

{% block extra_styles %}
<style>
  .welcome-banner {
    background: linear-gradient(135deg, rgba(217,97,71,.12) 0%, rgba(201,192,216,.18) 100%);
    border: 1px solid rgba(217,97,71,.2); border-radius: 20px;
    padding: 28px 32px; margin-bottom: 28px; position: relative; overflow: hidden;
  }
  .welcome-banner::before {
    content: 'alena'; position: absolute; right: -10px; bottom: -20px;
    font-family: 'Cormorant Garamond', serif; font-size: 90px; font-weight: 300;
    color: rgba(217,97,71,.08); pointer-events: none; line-height: 1;
  }
  .welcome-banner h2 {
    font-family: 'Cormorant Garamond', serif; font-size: 1.9rem;
    font-weight: 300; color: var(--warm-dark); margin-bottom: 6px;
  }
  .welcome-banner p { font-size: .88rem; color: var(--text-mid); }

  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-bottom: 28px; }
  .stat-card {
    background: var(--glass); backdrop-filter: blur(16px);
    border: 1px solid var(--glass-border); border-radius: 18px;
    padding: 22px 24px;
  }
  .stat-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.8rem; font-weight: 300; color: var(--coral); line-height: 1;
  }
  .stat-label { font-size: .8rem; color: var(--text-soft); margin-top: 4px; letter-spacing: .03em; }

  .section-heading {
    font-family: 'Cormorant Garamond', serif; font-size: 1.3rem;
    font-weight: 300; color: var(--warm-dark); margin-bottom: 16px;
  }
  .recent-list { display: flex; flex-direction: column; gap: 10px; }
  .recent-item {
    background: var(--glass); backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border); border-radius: 14px;
    padding: 14px 18px; display: flex; align-items: flex-start; gap: 14px;
  }
  .recent-q { font-size: .88rem; font-weight: 500; color: var(--warm-dark); margin-bottom: 4px; }
  .recent-a { font-size: .82rem; color: var(--text-mid); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .recent-time { font-size: .72rem; color: var(--text-soft); white-space: nowrap; margin-left: auto; padding-left: 12px; flex-shrink: 0; }
  .chat-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--coral); margin-top: 5px; flex-shrink: 0; }
  .empty-state { text-align: center; padding: 40px; color: var(--text-soft); font-size: .9rem; }
  .empty-state a { color: var(--coral); text-decoration: none; font-weight: 500; }

  .quick-actions { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 28px; }
</style>
{% endblock %}

{% block content %}
<div class="welcome-banner">
  <h2>Good day, {{ current_user.username }} ✦</h2>
  <p>Your knowledge base is ready. Ask anything or add new documents below.</p>
</div>

<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-num">{{ doc_count }}</div>
    <div class="stat-label">Documents</div>
  </div>
  <div class="stat-card">
    <div class="stat-num">{{ chat_count }}</div>
    <div class="stat-label">Questions Asked</div>
  </div>
  <div class="stat-card">
    <div class="stat-num" style="font-size:1.6rem; padding-top:6px;">AI</div>
    <div class="stat-label">Powered by RAG</div>
  </div>
</div>

<div class="quick-actions">
  <a href="{{ url_for('add_document') }}" class="btn btn-primary">
    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    Add Document
  </a>
  <a href="{{ url_for('documents') }}" class="btn btn-ghost">
    <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
    View Documents
  </a>
  <a href="{{ url_for('chat') }}" class="btn btn-ghost">
    <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
    Go to Chat
  </a>
</div>

<h3 class="section-heading">Recent conversations</h3>
{% if recent_chats %}
  <div class="recent-list">
    {% for chat in recent_chats %}
    <div class="recent-item">
      <div class="chat-dot"></div>
      <div style="flex:1; min-width:0;">
        <div class="recent-q">{{ chat.question }}</div>
        <div class="recent-a">{{ chat.answer }}</div>
      </div>
      <div class="recent-time">{{ chat.created_at.strftime('%b %d') }}</div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <div class="empty-state">
    No conversations yet. <a href="{{ url_for('chat') }}">Start chatting →</a>
  </div>
{% endif %}
{% endblock %}
